<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<!-- Inform modern browsers that this page supports both dark and light color schemes,
  and the page author prefers light. --><meta name="color-scheme" content="dark light">
<script>
  // If `prefers-color-scheme` is not supported, fall back to light mode.
  // i.e. In this case, inject the `light` CSS before the others, with
  // no media filter so that it will be downloaded with highest priority.
  if (window.matchMedia("(prefers-color-scheme: dark)").media === "not all") {
    document.documentElement.style.display = "none";
    document.head.insertAdjacentHTML(
      "beforeend",
      "<link id=\"css\" rel=\"stylesheet\" href=\"https://bootswatch.com/3/flatly/bootstrap.css\" onload=\"document.documentElement.style.display = ''\">"
    );
  }
</script><title>Model definitions • forecast.vocs</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- Flatly Theme - Light  --><link id="css-light" rel="stylesheet" href="https://bootswatch.com/3/flatly/bootstrap.css" media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)">
<!-- Darkly Theme - Dark --><link id="css-dark" rel="stylesheet" href="https://bootswatch.com/3/darkly/bootstrap.css" media="(prefers-color-scheme: dark)">
<!-- preferably CSS --><link rel="stylesheet" href="../preferably.css">
<link id="css-code-light" rel="stylesheet" href="../code-color-scheme-light.css" media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)">
<link id="css-code-dark" rel="stylesheet" href="../code-color-scheme-dark.css" media="(prefers-color-scheme: dark)">
<script src="../darkswitch.js"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Model definitions">
<meta property="og:description" content="forecast.vocs">
<meta property="og:image" content="epiforecasts.io/forecast.vocs/reference/figures/README-unnamed-chunk-8-1.png">
<meta property="og:image:alt" content="An R package for forecasting case and sequence notifications using variant of concern strain dynamics">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">forecast.vocs</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.7.6000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/model-definitions.html">Model definitions</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
          <a href="#" id="css-toggle-btn">
            <span class="fas fa-adjust fa-lg"></span>
          </a>
        </li>
        
        <li>
  <a href="https://github.com/epiforecasts/forecast.vocs/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
        
        


      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="model-definitions_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Model definitions</h1>
                        <h4 data-toc-skip class="author">Sam Abbott</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/epiforecasts/forecast.vocs/blob/HEAD/vignettes/model-definitions.Rmd" class="external-link"><code>vignettes/model-definitions.Rmd</code></a></small>
      <div class="hidden name"><code>model-definitions.Rmd</code></div>

    </div>

    
    
<p>The package currently supports two models both with various options. A baseline single strain model and a two strain model with flexible variable dynamics. These are defined in detail below.</p>
<div class="section level2">
<h2 id="single-strain">Single strain<a class="anchor" aria-label="anchor" href="#single-strain"></a>
</h2>
<p>We model the mean (<span class="math inline">\(\lambda_t\)</span>) of reported cases (<span class="math inline">\(C_t\)</span>) as an order 1 autoregressive (AR(1)) process on the log scale by time unit (<span class="math inline">\(t\)</span>). The model is initialised by assuming that the initial reported cases are representative with a small amount of error (2.5%).</p>
<p><span class="math display">\[\begin{align}
  \log \lambda_0 &amp;\sim \text{LogNormal}\left(\log C_0 , 0.025 \times \log C_0 \right) \\
  \log \lambda_t &amp;= \log \lambda_{t-1} + r_t
\end{align}\]</span></p>
<p>Where <span class="math inline">\(r_t\)</span> can be interpreted as the growth rate and the exponential of <span class="math inline">\(r_t\)</span> as the effective reproduction number (<span class="math inline">\(R_t\)</span>) assuming a mean generation time equal to the scaling rate used (see the documentation for <code>scale_r</code> in <code>?forecast()</code>). <span class="math inline">\(r_t\)</span> is then itself modelled as a differenced AR(1) process,</p>
<p><span class="math display">\[\begin{align}
  r_0 &amp;\sim \text{Normal}\left(0, 0.25 \right) \\
  r_t &amp;= r_{t-1} + \epsilon_t  \\
  \epsilon_0 &amp;= \eta_0 \\
  \epsilon_t &amp;= \beta \epsilon_{t-1} + \eta_t
\end{align}\]</span></p>
<p>Where,</p>
<p><span class="math display">\[\begin{align}
  \eta_t &amp;\sim \text{Normal}\left(0, \sigma \right) \\
  \sigma &amp;\sim \text{Normal}\left(0, 0.1 \right) \\
  \beta &amp;\sim \text{Normal}\left(0, 1 \right)
\end{align}\]</span></p>
<p>We then assume a negative binomial observation model with overdispersion <span class="math inline">\(\phi_c\)</span> for reported cases (<span class="math inline">\(C_t\)</span>),</p>
<p><span class="math display">\[\begin{align}
  C_{t} &amp;\sim \text{NegBinomial}\left(\lambda_t, \phi_c\right) \\
  \frac{1}{\sqrt{\phi_c}} &amp;\sim \text{Normal}(0, 1) 
\end{align}\]</span></p>
<p>Where <span class="math inline">\(\sigma\)</span>, and <span class="math inline">\(\frac{1}{\sqrt{phi_c}}\)</span> are truncated to be greater than 0 and <span class="math inline">\(\beta\)</span> is truncated to be between -1 and 1. Optionally a Poisson observation model may instead be used (see the documentation for <code>overdispersion</code> in <code>?forecast()</code>).</p>
<p>The stan code for this model available <a href="https://github.com/epiforecasts/forecast.vocs/blob/main/inst/stan/bp.stan" class="external-link">here</a> or can be loaded into <code>R</code> using the following code,</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://epiforecasts.io/forecast.vocs/">forecast.vocs</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/readLines.html" class="external-link">readLines</a></span><span class="op">(</span><span class="fu"><a href="../reference/fv_model.html">fv_model</a></span><span class="op">(</span>strains <span class="op">=</span> <span class="fl">1</span>, compile <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="two-strain">Two strain<a class="anchor" aria-label="anchor" href="#two-strain"></a>
</h2>
<p>We model strain dynamics using the single strain model as a starting point but with the addition of strain specific AR(1) variation and a beta binomial (or optionally binomial) observation process for sequence data. The full two strain model is described below. Parameters related to the variant of concern (VoC) are given the <span class="math inline">\(\delta\)</span> superscript and parameters related to non-VoC cases are given the <span class="math inline">\(o\)</span> superscript.</p>
<p>Mean reported cases are again defined using a AR(1) process on the log scale for each strain and the combined for overall mean reported cases.</p>
<p><span class="math display">\[\begin{align}
  \log \lambda_0 &amp;\sim \text{LogNormal}\left(\log C_0 , 0.025 \times \log C_0 \right) \\
  \log \lambda^{\delta}_0 &amp;\sim \text{LogNormal}\left(\log C^{\delta}_0 , 0.025 \times \log C^{\delta}_0 \right) \\
  \log \lambda^{o}_0 &amp;= \log \left(\lambda_0 - \lambda^{\delta}_0 \right) \\
  \log \lambda^{\delta}_t &amp;= \log \lambda^{\delta}_{t-1} + r^{\delta}_t \\
  \log \lambda^{o}_t &amp;= \log \lambda^{o}_{t-1} + r^{o}_t \\
  \lambda_t &amp;= \lambda^{\delta}_t + \lambda^{o}_t
\end{align}\]</span></p>
<p>Where <span class="math inline">\(C^{\delta}_0\)</span> is derived by calculating the mean proportion of cases that had the VoC for the first time point using the overall number of reported cases, the number of sequenced cases, and the number of sequences that were positive for the VoC. The growth rate for VoC and non-VoC cases (<span class="math inline">\(r^{o, \delta}_t\)</span>) is then modelled as a combination of an overall growth rate (<span class="math inline">\(r_t\)</span> as defined for the single strain model), a strain specific modifier (<span class="math inline">\(s^{o, \delta}_0\)</span>), and an AR(1) error term post introduction (<span class="math inline">\(\epsilon^{o, \delta}_t\)</span>).</p>
<p><span class="math display">\[\begin{align}
  r^{o, \delta}_t &amp;= r_t + s^{o, \delta} + \epsilon^{o, \delta}_t \\
  \epsilon^{o, \delta}_0 &amp;= 0 \\
  \epsilon^{o, \delta}_t &amp;= \epsilon^{o, \delta}_{t-1} + \eta^{o, \delta}
\end{align}\]</span></p>
<p>Where,</p>
<p><span class="math display">\[\begin{align}
  \eta^{o, \delta}_t &amp;\sim \text{Normal}\left(0, \sigma^{o, \delta} \right) \\
  \sigma^{o, \delta} &amp;\sim \text{Normal}\left(0, 0.1 \right) \\
  s^o &amp;= 0 \\
  s^{\beta} &amp;\sim \text{Normal}(0, 0.5)
\end{align}\]</span></p>
<p>Which assumes an uninformed transmissibility difference for the VoC vs non-VoC cases. It is strongly encouraged that users use their domain knowledge to inform this prior. The relationship between variations can be altered so that the VoC differs only by the transmissibility difference (s^{}) to the non-VOC strain and any variation over time is shared between strains. Optionally strains can also be modelled to evolve independently over time. See the documentation for <code>variant_relationship</code> in <code>?forecast()</code> for details. For most users the default pooled method is recommended. </p>
<p>Finally, the mean proportion of samples that have the VoC (<span class="math inline">\(p_t\)</span>) is then estimated using the mean reported cases with the VoC and the overall mean reported cases.</p>
<p><span class="math display">\[\begin{equation} 
  p_t = \frac{\lambda^{\delta}_t}{\lambda_t}
\end{equation}\]</span></p>
<p>We assume a beta binomial observation model for the number of sequences (<span class="math inline">\(N_t\)</span>) that are positive (<span class="math inline">\(P_t\)</span>) for the VoC with overdispersion <span class="math inline">\(\phi_s\)</span>.</p>
<p><span class="math display">\[\begin{align}
  P_{t} &amp;\sim \mathrm{BetaBinomial}\left(N_t, p_t \phi_s, (1 - p_t) \phi_s\right) \\
  \frac{1}{\sqrt{\phi_s}} &amp;\sim \mathcal{N}(0, 1) 
\end{align}\]</span></p>
<p>Where <span class="math inline">\(\sigma^{o, \delta}\)</span>, and <span class="math inline">\(\frac{1}{\sqrt{\phi_s}}\)</span> are truncated to be greater than 0. A binomial observation model is also available (see the documentation for <code>overdispersion</code> in <code>?forecast()</code>).</p>
<p>The stan code for this model available <a href="https://github.com/epiforecasts/forecast.vocs/blob/main/inst/stan/twostrainbp.stan" class="external-link">here</a> or can be loaded into <code>R</code> using the following code,</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://epiforecasts.io/forecast.vocs/">forecast.vocs</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/readLines.html" class="external-link">readLines</a></span><span class="op">(</span><span class="fu"><a href="../reference/fv_model.html">fv_model</a></span><span class="op">(</span>strains <span class="op">=</span> <span class="fl">2</span>, compile <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by .</p>
</div>

<div class="pkgdown">
  <p>Made with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> , using <a href="https://preferably.amirmasoudabdol.name/?source=footer" class="external-link">preferably</a> template.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
